/* pkcs12.js
 *
 * Copyright (C) 2006-2022 wolfSSL Inc.
 *
 * This file is part of wolfSSL.
 *
 * wolfSSL is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the Licenseor
 * (at your option) any later version.
 *
 * wolfSSL is distributed in the hope that it will be useful * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if notwrite to the Free Software
 * FoundationInc.51 Franklin StreetFifth FloorBostonMA 02110-1335USA
 */
const { WolfSSL_PKCS12 } = require( '../interfaces/pkcs12' )
const key = Buffer.from(
'308204A50201000282010100C09508E15741F2716DB7D24541270165C645AEF2BC2430B895CE2F4ED6F61C88BC7C9FFBA8677FFE5C9C5175F78ACA07E7352F8FE1BD7BC02F7CAB64A817FCCA5D7BBAE021E5722E6F2E86D89573DAAC1B53B95F3FD7190D254FE16363518B0B643FAD43B8A51C5C34B3AE00A063C5F67F0B59687873A68C18A9026DAFC319012EB810E3C6CC40B469A3463369876EC4BB17A6F3E8DDAD73BC7B2F21B5FD66510CBD54B3E16D5F1CBC2373D109038914D210B964C32AD0A1964ABCE1D41A5BC7A0C0C163780F443730329680322395A177BA13D29773E25D25C96A0DC33960A4B4B069424209E9D808BC3320B35822A7AAEBC4E1E66183C5D296DFD9D04FADD7020301000102820101009AD0340F5262055001EF9FED646EC2C4DA1AF284D792104892C4E96AEB8B756CC67938F2C9724A8664549577CBC39A9DB7D41DA400C89E4EE4DDC7BA6716C174BCA9D6948F2B301AFBEDDF210523D94A39BD986B659AB8DCC47DEEA643152E3DBE1D22602A7330D53ED8A2AC86432EC4F5645E3F89750F11D851254E9FD8AAA3CE60B3E28AD97E1BF064CA9A5B050B5BAACBE5E33F6E322205F3D0FAEF745281E25F74D3BDFF31834575FA637A972ED6B619C69226E4280650500E782EA9780D1497B412D83140ABA10141C230F8075F16E46177D260F29F8DE8F4BAEB63DE2A9781EF4C6CE65534512B2834F4531CC4580A3FBBAFB5F74A85432D3CF158588102818100F22C5476392363C91032B793ADAFBE1975968164E6B5B8894241D16DD01C1BF81BAC69CB363C647DDCF419B8C360B157485F524F593A557F32C01943503FAECE6F17F30E9F40CA4EAD153BC979E9C0593873709C0A7CC93A4832A7D849750A85C2C2FD1573DA99092A699A9F0A71BFB004A68C7A5A6F485A543BC6B15317DFE702818100CB93DE77155DB75C5C7CD890A9982DD6690E63B3A3DCA6CC8B6AA4A2128C8E7B482CB24B37DC06187DEAFE76A1D4A1E93F0DCD1B5FAF5F9E965B5B0FA17CAFB39B90DB57733AEDB02344AE414F1F074213234CCBFAF414A4D5F79E367C5B9FA83CC1855F74D2392DFFD084DFFBB3207A2E9B17AEE6BA0BAE5F53A452ED1BC49102818100EC98DABBD5FEF9524A7D0255496F556E522F84A32BB38662B354D26352DAE38876A0EF8B15A5D3181472775EC7A3041F9E1962B51B1B9EC3F2B532F94CC1AAEB0C267DD45F4A515CA445067044A756C0D42214769ED863508990D3E2BF819592314187391A430B18A5531F391A5F1F43BC876ADF6ED32200FE2298704E1A1929028181008A415628519E5FD49E0B3B98A354F26C56D4AAE9693385240CDAD40C2DC4BF4F0269387CD4E6DC4CEDD71611C33E00E7C326C05102DEBB759C6F569C7AF38EEFCF8AC52BD2DA066A44C973FE6E9987F85BBEF17CE665B54F6CF0C9C5FF16CA8B1B17E2583DA237AB01BCBF40CE538C8EEDEFEE599DE063E67C5EF58E4BF13BC10281804D45F9408CC55BF42A1A8AB4F21CAC6BE90C5636B74E7296D5E58AD2E2FFF1F118133D8609B8D876A7C91C7152943043E0F17874FD611B4C09CCE6682A71AD1CDF43BC56DBA5A4BE3570A45ECF4FFC0055993A3D23CF675AF522F8B529D04411EB352E46BEFD8E18B25FA8BF1932A1F5DC03E67C9A1F0C7CA9B00E21373BF1B0', 'hex');
const cert = Buffer.from(
'308204E8308203D0A003020102020101300D06092A864886F70D01010B0500308194310B30090603550406130255533110300E06035504080C074D6F6E74616E613110300E06035504070C07426F7A656D616E3111300F060355040A0C08536177746F6F746831133011060355040B0C0A436F6E73756C74696E673118301606035504030C0F7777772E776F6C6673736C2E636F6D311F301D06092A864886F70D0109011610696E666F40776F6C6673736C2E636F6D301E170D3233313231333232313932385A170D3236303930383232313932385A308190310B30090603550406130255533110300E06035504080C074D6F6E74616E613110300E06035504070C07426F7A656D616E3110300E060355040A0C07776F6C6653534C3110300E060355040B0C07537570706F72743118301606035504030C0F7777772E776F6C6673736C2E636F6D311F301D06092A864886F70D0109011610696E666F40776F6C6673736C2E636F6D30820122300D06092A864886F70D01010105000382010F003082010A0282010100C09508E15741F2716DB7D24541270165C645AEF2BC2430B895CE2F4ED6F61C88BC7C9FFBA8677FFE5C9C5175F78ACA07E7352F8FE1BD7BC02F7CAB64A817FCCA5D7BBAE021E5722E6F2E86D89573DAAC1B53B95F3FD7190D254FE16363518B0B643FAD43B8A51C5C34B3AE00A063C5F67F0B59687873A68C18A9026DAFC319012EB810E3C6CC40B469A3463369876EC4BB17A6F3E8DDAD73BC7B2F21B5FD66510CBD54B3E16D5F1CBC2373D109038914D210B964C32AD0A1964ABCE1D41A5BC7A0C0C163780F443730329680322395A177BA13D29773E25D25C96A0DC33960A4B4B069424209E9D808BC3320B35822A7AAEBC4E1E66183C5D296DFD9D04FADD70203010001A382014530820141301D0603551D0E04160414B31132C9929884E2C9F8D03B6E0342CA1F0E8E3C3081D40603551D230481CC3081C98014278E671174C3261D3FED3363B3A4D81D30E5E8D5A1819AA48197308194310B30090603550406130255533110300E06035504080C074D6F6E74616E613110300E06035504070C07426F7A656D616E3111300F060355040A0C08536177746F6F746831133011060355040B0C0A436F6E73756C74696E673118301606035504030C0F7777772E776F6C6673736C2E636F6D311F301D06092A864886F70D0109011610696E666F40776F6C6673736C2E636F6D821433441AA86C01ECF660F270510A4CD114FABCE944300C0603551D13040530030101FF301C0603551D1104153013820B6578616D706C652E636F6D87047F000001301D0603551D250416301406082B0601050507030106082B06010505070302300D06092A864886F70D01010B050003820101004AFFB9E5859BDA53667F0722BFB619EA42EBA4110762FF395F33373A8726713D13B2CAB864387B8A99480EA5A46BB1996EE04651BD1952ADBCA67E2A7A7C23A7CCDB5E437D6B04C8B7DD95ADF0918059C51991262791B8481CEB55B6AA7DA438F103BC6C8BAA94D63C057A96C506F126142E75FBDDE535B3012CB3AD625A219A08BE56FCF9A2428786E5A9C599CFAE14BEE0B908240D1D5CD614E14C9F40B3A9E92D528B4CBFAC443167C18D0685EC0FE499D74B7B210666D4E4F59DFF8EF08639581DA45BE263EF7CC91887A80225103E8728F9F5EF479EA58008119068FED1A3A851B937FFD5CA7C877F6BBC2C12C8C5858BFC0CC6B986B8C904C35137D24F', 'hex');
const caCert = Buffer.from(
'308204FF308203E7A003020102021433441AA86C01ECF660F270510A4CD114FABCE944300D06092A864886F70D01010B0500308194310B30090603550406130255533110300E06035504080C074D6F6E74616E613110300E06035504070C07426F7A656D616E3111300F060355040A0C08536177746F6F746831133011060355040B0C0A436F6E73756C74696E673118301606035504030C0F7777772E776F6C6673736C2E636F6D311F301D06092A864886F70D0109011610696E666F40776F6C6673736C2E636F6D301E170D3233313231333232313932385A170D3236303930383232313932385A308194310B30090603550406130255533110300E06035504080C074D6F6E74616E613110300E06035504070C07426F7A656D616E3111300F060355040A0C08536177746F6F746831133011060355040B0C0A436F6E73756C74696E673118301606035504030C0F7777772E776F6C6673736C2E636F6D311F301D06092A864886F70D0109011610696E666F40776F6C6673736C2E636F6D30820122300D06092A864886F70D01010105000382010F003082010A0282010100BF0CCA2D14B21E84425BCD381F4AF24D7510F1B6359FDFCA7D0398D3ACDE0366EE2AF1D8B07D6E07540B1098214D80CB1220E7CC4FDE457DC9727732EACA90BB695210032FA8F395C5F18B62561BEF676FA4104195AD0A9BE3A5C0B0D2707650305BA8E8082C7CEDA7A27A8D38291CACC7EDF27C95B095827D495C38CD7725EFBD807553943C3DCA635B9F15B5D31D132F19D13CDB763ACCB87DC9E5C2D7DA406FD821DC731B422D539CFE1AFC7DAB7A363F98DE847C0567CE6A143887A9F18CB568CB687F71202BF5A063F5562FA326D2B76FB15A17D7389908FE93586FFEC3134908160BA74D6700523167234E98ED51451DB904D90BECD828B34BBDED36790203010001A382014530820141301D0603551D0E04160414278E671174C3261D3FED3363B3A4D81D30E5E8D53081D40603551D230481CC3081C98014278E671174C3261D3FED3363B3A4D81D30E5E8D5A1819AA48197308194310B30090603550406130255533110300E06035504080C074D6F6E74616E613110300E06035504070C07426F7A656D616E3111300F060355040A0C08536177746F6F746831133011060355040B0C0A436F6E73756C74696E673118301606035504030C0F7777772E776F6C6673736C2E636F6D311F301D06092A864886F70D0109011610696E666F40776F6C6673736C2E636F6D821433441AA86C01ECF660F270510A4CD114FABCE944300C0603551D13040530030101FF301C0603551D1104153013820B6578616D706C652E636F6D87047F000001301D0603551D250416301406082B0601050507030106082B06010505070302300D06092A864886F70D01010B050003820101002DFCF9325ABED69D428B864E6722C3502DCB14271D94F3CD8842DA411C392467A7924D27EA568219BF11B243A48D5D87B22764668281DFC4FD5B62B0C24D9D29F24132CC2EB5DA38061BE87F8C6E3D801E005649BF39E0DA682FC4FD00E6D1811AD14ABB7652CE4D249DC4A3A7F165142F1FA82DC6CBCEB1A789742627C3F3A3844C340114037D163AC88B252E7B90CC46B15234BA936EEFFE43A3ADC66F51FBBAEA38E36FD6EE636236EA5E08B4E22A4689E3AEB3B406EF637A6E5DDDC9EC024FF764C02707B46F4A18725B34747CD0A9048F408B6A39D26B1A01F201A881343AE5B055D13C95CAB082D6ED982815597E95A769C7B57BEC01A74DE6B9A2FE35', 'hex');

const pkcs12_tests =
{
    createAndParse: function()
    {
        let pkcs12Create = new WolfSSL_PKCS12()
        let pkcs12Parse = new WolfSSL_PKCS12()

        pkcs12Create.Create('my secure password :D', key, cert, [caCert],
            WolfSSL_PKCS12.PBE_SHA1_DES3, WolfSSL_PKCS12.PBE_SHA1_DES3, 100,
            100)

        let der = pkcs12Create.InternalToDer()

        pkcs12Parse.DerToInternal(der)

        let out = pkcs12Parse.Parse('my secure password :D')

        pkcs12Create.free()
        pkcs12Parse.free()

        if (!out.key.equals(key) || !out.cert.equals(cert) || !out.derList[0].equals(caCert)) {
            console.log('FAIL PKCS12 createAndParse')
        }
        else {
            console.log('PASS PKCS12 createAndParse')
        }
    }
}

module.exports = pkcs12_tests
